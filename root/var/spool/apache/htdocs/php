<CENTER>
<CENTER>
<TABLE CELLPADDING=0 CELLSPACING=0 WIDTH=90%>
<FORM NAME=ppage METHOD=POST>
<INPUT TYPE=HIDDEN NAME=disppage VALUE=<%print $disppage;%>>
<INPUT TYPE=HIDDEN NAME=print>
</FORM>
<FORM NAME=officehours METHOD=POST>
<INPUT TYPE=HIDDEN NAME=showmenu VALUE="<%print $showmenu;%>">
<INPUT TYPE=HIDDEN NAME=disppage VALUE="<%print $disppage;%>">
<INPUT TYPE=HIDDEN NAME=index VALUE="">
<INPUT TYPE=HIDDEN NAME=timerange VALUE="">
<%
include_once "cdr/auth.inc";
include_once "ldap/auth.inc";

$sr=ldap_search($ds,"ou=Admin","(&(objectclass=groupofnames)(member=" . $ldn . ")(cn=Admin Access))");
if ((ldap_count_entries($ds,$sr) == 1) || ($PHP_AUTH_USER == "admin")) {
  $ADMIN_USER="admin";
} else {
  $ADMIN_USER="pleb";
}

$rcol=1;
if (($print != "1") && ($ADMIN_USER != "pleb")) {
  $cspan="4";
} else {
  $cspan="3";
}

print "<TR CLASS=list-color" . (($rcol % 2 )+1) . "><TH COLSPAN=" . $cspan . ">" . _("Forward Trunk Maping") . 
"</TH></TR>\n";
$rcol++;
print "<TR CLASS=list-color" . (($rcol % 2 )+1) . ">";
if (($print != "1") && ($ADMIN_USER != "pleb")) {
  print "<TH>" . _("Delete") . "</TH>";
}
print "<TH>" . _("Prefix") . "</TH><TH>" . _("Digits To Strip") . "</TH>";
print "<TH>" . _("Match") . "</TH>\n</TR>";
$rcol++;

if ($match != "") {
  if ($strip == "") {
    $strip=0;
  }
  pg_query($db,"INSERT INTO trunkmap (prefix,strip,match) VALUES ('" . $prefix . "'," . $strip . ",'" . $match . "')");
}

$tmap=pg_query($db,"SELECT prefix,strip,match,id FROM trunkmap ORDER by length(prefix)");

for($tcnt=0;$tcnt<pg_num_rows($tmap);$tcnt++) {
  $r=pg_fetch_array($tmap,$tcnt);
  $todel="del" . $r[3];
  if ($$todel == "on") {
    pg_query("DELETE FROM trunkmap WHERE id=" . $r[3]);
    continue;
  }

  print "<TR CLASS=list-color" . (($rcol % 2 )+1) . ">";
  if (($print != "1") && ($ADMIN_USER != "pleb")) {
    print "<TD><INPUT TYPE=CHECKBOX NAME=del" . $r[3] . "></TD>";
  }
  print "<TD>" . $r[0] . "</TD><TD>" . $r[1] . "</TD><TD>" . $r[2];
  print "</TD></TR>\n";
  $rcol++;
}

print "<TR CLASS=list-color" . (($rcol % 2 )+1) . "><TH ALIGN=LEFT>New</TD>";

print "<TD><INPUT TYPE=TEXT NAME=prefix MAXLEN=5 SIZE=5 VALUE=></TD>";
print "<TD><INPUT TYPE=TEXT NAME=strip MAXLEN=5 SIZE=5 VALUE=></TD>";
print "<TD><INPUT TYPE=TEXT NAME=match MAXLEN=200 SIZE=30 VALUE=></TD>";

print "</TR>\n";

$rcol++;

if ($print != "1") {
  print "<TR CLASS=list-color" . (($rcol % 2)+1) . "><TH COLSPAN=" . $cspan . " CLASS=heading-body>";
  if ($ADMIN_USER == "admin") {
    print "<INPUT TYPE=SUBMIT VALUE=\"" . _("Update") . "\">";
  }
  print "<INPUT TYPE=BUTTON NAME=pbutton VALUE=\"" . _("Print") . "\" ONCLICK=\"printpage(document.ppage)\"></TH></TR>\n";
}
%>
</FORM>
</TABLE>
